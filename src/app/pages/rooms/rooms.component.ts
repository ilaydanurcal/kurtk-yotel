import { Component, OnInit, ChangeDetectionStrategy, AfterViewInit, ChangeDetectorRef } from '@angular/core';
import { CommonModule } from '@angular/common';
import { RouterLink } from '@angular/router';
import { SeoService } from '../../services/seo.service';
import { ImageLoaderService } from '../../services/image-loader.service';

@Component({
  selector: 'app-rooms',
  standalone: true,
  imports: [CommonModule, RouterLink],
  templateUrl: './rooms.component.html',
  styleUrl: './rooms.component.css',
  changeDetection: ChangeDetectionStrategy.OnPush
})
export class RoomsComponent implements OnInit, AfterViewInit {
  phoneNumber = '02163071217';
  whatsappNumber = '905451705050';

  constructor(
    private seo: SeoService,
    private imageLoader: ImageLoaderService,
    private cdr: ChangeDetectorRef
  ) {}

  ngOnInit() {
    this.seo.updatePageForRoute('/odalar');
    // Ä°lk gÃ¶rÃ¼nen resmi Ã¶nceden yÃ¼kle
    if (this.rooms.length > 0) {
      this.imageLoader.preloadImage(this.rooms[0].image).catch(() => {});
    }
  }

  ngAfterViewInit() {
    // Lazy load resimleri gÃ¶zlemle
    setTimeout(() => {
      const images = document.querySelectorAll('img[data-src]');
      images.forEach((img) => {
        this.imageLoader.observeImage(img as HTMLImageElement);
      });
    }, 100);
  }

  rooms = [
    {
      id: 1,
      name: 'Standart Oda',
      slug: 'standart-oda',
      image: 'assets/images/standart-room.JPG',
      gallery: [
        'assets/images/standart-room.JPG',
        'assets/images/standart-room-1.JPG',
        'assets/images/standart-room-2.JPG',
        'assets/images/standart-room-3.JPG'
      ],
      area: '20 mÂ²',
      capacity: '2 KiÅŸi',
      bedType: 'Ã‡ift KiÅŸilik Yatak',
      description: 'Ekonomik ve konforlu standart odalarÄ±mÄ±z, tÃ¼m temel ihtiyaÃ§larÄ±nÄ±zÄ± karÅŸÄ±layacak ÅŸekilde modern donanÄ±mla tasarlanmÄ±ÅŸtÄ±r. Ä°ÅŸ seyahatleri ve kÄ±sa sÃ¼reli konaklamalar iÃ§in idealdir.',
      features: [
        { icon: 'â„ï¸', name: 'Klima', description: 'Merkezi klima sistemi' },
        { icon: 'ğŸ“¶', name: 'Ãœcretsiz WiFi', description: 'YÃ¼ksek hÄ±zlÄ± internet' },
        { icon: 'ğŸ“º', name: 'AkÄ±llÄ± TV', description: 'Uydu yayÄ±nÄ±' },
        { icon: 'ğŸ›', name: 'Ã–zel Banyo', description: 'Modern donanÄ±mlÄ±' },
        { icon: 'ğŸ’¼', name: 'Ã‡alÄ±ÅŸma MasasÄ±', description: 'Ä°ÅŸ seyahatleri iÃ§in' },
        { icon: 'ğŸ§Š', name: 'Mini BuzdolabÄ±', description: 'Ä°htiyaÃ§larÄ±nÄ±z iÃ§in' }
      ],
      amenities: ['Klima', 'WiFi', 'TV', 'Banyo', 'Ã‡alÄ±ÅŸma MasasÄ±', 'Mini BuzdolabÄ±']
    },
    {
      id: 2,
      name: 'Superior Oda',
      slug: 'superior-oda',
      image: 'assets/images/superior-room.JPG',
      gallery: [
        'assets/images/superior-room.JPG',
        'assets/images/superior-1.JPG',
        'assets/images/superior-2.JPG',
        'assets/images/superior-3.JPG'
      ],
      area: '30 mÂ²',
      capacity: '2 KiÅŸi',
      bedType: 'Ã‡ift KiÅŸilik Yatak',
      description: 'GeniÅŸ ve lÃ¼ks superior odalarÄ±mÄ±z, daha fazla konfor ve alan arayan misafirlerimiz iÃ§in idealdir. Modern dekorasyon ve premium olanaklarla unutulmaz bir konaklama deneyimi sunar.',
      features: [
        { icon: 'â„ï¸', name: 'Klima', description: 'Merkezi klima sistemi' },
        { icon: 'ğŸ“¶', name: 'Ãœcretsiz WiFi', description: 'YÃ¼ksek hÄ±zlÄ± internet' },
        { icon: 'ğŸ“º', name: 'AkÄ±llÄ± TV', description: 'Uydu yayÄ±nÄ±' },
        { icon: 'ğŸ›', name: 'LÃ¼ks Banyo', description: 'Premium donanÄ±m' },
        { icon: 'ğŸŒ³', name: 'Balkon', description: 'Åehir manzarasÄ±' },
        { icon: 'ğŸ§Š', name: 'Mini BuzdolabÄ±', description: 'Ä°htiyaÃ§larÄ±nÄ±z iÃ§in' }
      ],
      amenities: ['Klima', 'WiFi', 'TV', 'LÃ¼ks Banyo', 'Balkon', 'Mini BuzdolabÄ±']
    },
    {
      id: 3,
      name: 'Jakuzili Oda',
      slug: 'jakuzili-oda',
      image: 'assets/images/jakuzi-room.jpg',
      gallery: [
        'assets/images/jakuzi-room.jpg',
        'assets/images/jakuzi-room-1.jpg',
        'assets/images/jakuzi-room-2.jpg',
        'assets/images/jakuzi-room-3.jpg'
      ],
      area: '35 mÂ²',
      capacity: '2 KiÅŸi',
      bedType: 'Ã‡ift KiÅŸilik Yatak',
      description: 'Ã–zel jakuzi ile lÃ¼ks bir konaklama deneyimi sunan odalarÄ±mÄ±z, romantik kaÃ§amaklar ve Ã¶zel anlar iÃ§in mÃ¼kemmeldir. Premium olanaklar ve Ã¶zel tasarÄ±m ile unutulmaz bir deneyim.',
      features: [
        { icon: 'ğŸ›', name: 'Ã–zel Jakuzi', description: 'RahatlatÄ±cÄ± jakuzi keyfi' },
        { icon: 'â„ï¸', name: 'Klima', description: 'Merkezi klima sistemi' },
        { icon: 'ğŸ“¶', name: 'Ãœcretsiz WiFi', description: 'YÃ¼ksek hÄ±zlÄ± internet' },
        { icon: 'ğŸ“º', name: 'AkÄ±llÄ± TV', description: 'Uydu yayÄ±nÄ±' },
        { icon: 'ğŸ›', name: 'LÃ¼ks Banyo', description: 'Premium donanÄ±m' },
        { icon: 'ğŸ•¯ï¸', name: 'Romantik Dekorasyon', description: 'Ã–zel tasarÄ±m' }
      ],
      amenities: ['Jakuzi', 'Klima', 'WiFi', 'TV', 'LÃ¼ks Banyo', 'Romantik Dekorasyon']
    },
    {
      id: 4,
      name: 'Aile OdasÄ±',
      slug: 'aile-odasi',
      image: 'assets/images/aile-odasi-room.jpg',
      gallery: [
        'assets/images/aile-odasi-room.jpg',
        'assets/images/aile-odasi-room-1.jpg',
        'assets/images/aile-odasi-room-2.jpg',
        'assets/images/aile-odasi-room-3.jpg'
      ],
      area: '40 mÂ²',
      capacity: '4-5 KiÅŸi',
      bedType: 'Ã‡ift KiÅŸilik + Tek KiÅŸilik Yatak',
      description: 'Aileler iÃ§in geniÅŸ ve konforlu odalarÄ±mÄ±z, Ã§ocuklu misafirlerimiz iÃ§in Ã¶zel olarak tasarlanmÄ±ÅŸtÄ±r. GeniÅŸ alan, gÃ¼venli ortam ve aile dostu olanaklarla rahat bir konaklama sunar.',
      features: [
        { icon: 'ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦', name: 'Aile Dostu', description: 'Ã‡ocuklar iÃ§in gÃ¼venli' },
        { icon: 'â„ï¸', name: 'Klima', description: 'Merkezi klima sistemi' },
        { icon: 'ğŸ“¶', name: 'Ãœcretsiz WiFi', description: 'YÃ¼ksek hÄ±zlÄ± internet' },
        { icon: 'ğŸ“º', name: 'AkÄ±llÄ± TV', description: 'Uydu yayÄ±nÄ±' },
        { icon: 'ğŸ›', name: 'Banyo', description: 'Modern donanÄ±mlÄ±' },
        { icon: 'ğŸŒ³', name: 'Balkon', description: 'GeniÅŸ balkon alanÄ±' }
      ],
      amenities: ['Aile Dostu', 'Klima', 'WiFi', 'TV', 'Banyo', 'Balkon']
    },
    {
      id: 5,
      name: 'ÃœÃ§ KiÅŸilik Oda',
      slug: 'uc-kisilik-oda',
      image: 'assets/images/triple-room.JPG',
      gallery: [
        'assets/images/triple-room.JPG',
        'assets/images/triple-room-1.JPG',
        'assets/images/triple-room-2.JPG',
        'assets/images/triple-room-3.JPG'
      ],
      area: '28 mÂ²',
      capacity: '3 KiÅŸi',
      bedType: 'ÃœÃ§ Tek KiÅŸilik Yatak',
      description: 'ÃœÃ§ kiÅŸilik konaklama iÃ§in uygun, geniÅŸ ve konforlu odalarÄ±mÄ±z. ArkadaÅŸ gruplarÄ± ve kÃ¼Ã§Ã¼k aileler iÃ§in ideal bir seÃ§enek. TÃ¼m temel olanaklar ve rahat bir ortam sunar.',
      features: [
        { icon: 'ğŸ‘¥', name: 'ÃœÃ§ KiÅŸilik', description: 'Rahat konaklama' },
        { icon: 'â„ï¸', name: 'Klima', description: 'Merkezi klima sistemi' },
        { icon: 'ğŸ“¶', name: 'Ãœcretsiz WiFi', description: 'YÃ¼ksek hÄ±zlÄ± internet' },
        { icon: 'ğŸ“º', name: 'AkÄ±llÄ± TV', description: 'Uydu yayÄ±nÄ±' },
        { icon: 'ğŸ›', name: 'Banyo', description: 'Modern donanÄ±mlÄ±' },
        { icon: 'ğŸ’¼', name: 'Ã‡alÄ±ÅŸma MasasÄ±', description: 'Ä°ÅŸ seyahatleri iÃ§in' }
      ],
      amenities: ['ÃœÃ§ KiÅŸilik', 'Klima', 'WiFi', 'TV', 'Banyo', 'Ã‡alÄ±ÅŸma MasasÄ±']
    },
    {
      id: 6,
      name: 'DÃ¶rt KiÅŸilik Oda',
      slug: 'dort-kisilik-oda',
      image: 'assets/images/quard-room-1.jpg',
      gallery: [
        'assets/images/quard-room-1.jpg',
        'assets/images/quard-room.jpg',
        'assets/images/quard-room-2.jpg',
        'assets/images/quard-room-3.jpg'
      ],
      area: '35 mÂ²',
      capacity: '4 KiÅŸi',
      bedType: 'DÃ¶rt Tek KiÅŸilik Yatak',
      description: 'Grup konaklamalarÄ± iÃ§in ideal, geniÅŸ dÃ¶rt kiÅŸilik odalarÄ±mÄ±z. ArkadaÅŸ gruplarÄ± ve aileler iÃ§in mÃ¼kemmel bir seÃ§enek. GeniÅŸ alan ve tÃ¼m konfor olanaklarÄ± ile rahat bir konaklama.',
      features: [
        { icon: 'ğŸ‘¥', name: 'DÃ¶rt KiÅŸilik', description: 'Grup konaklamasÄ±' },
        { icon: 'â„ï¸', name: 'Klima', description: 'Merkezi klima sistemi' },
        { icon: 'ğŸ“¶', name: 'Ãœcretsiz WiFi', description: 'YÃ¼ksek hÄ±zlÄ± internet' },
        { icon: 'ğŸ“º', name: 'AkÄ±llÄ± TV', description: 'Uydu yayÄ±nÄ±' },
        { icon: 'ğŸ›', name: 'Banyo', description: 'Modern donanÄ±mlÄ±' },
        { icon: 'ğŸŒ³', name: 'Balkon', description: 'Åehir manzarasÄ±' }
      ],
      amenities: ['DÃ¶rt KiÅŸilik', 'Klima', 'WiFi', 'TV', 'Banyo', 'Balkon']
    },
    {
      id: 7,
      name: 'Ekonomik Oda',
      slug: 'ekonomik-oda',
      image: 'assets/images/ekonomik-room-1.jpg',
      gallery: [
        'assets/images/ekonomik-room-1.jpg',
        'assets/images/ekonomik-room.jpg',
        'assets/images/ekonomik-room-2.jpg',
        'assets/images/ekonomik-room-3.JPG'
      ],
      area: '18 mÂ²',
      capacity: '1 KiÅŸi',
      bedType: 'Tek KiÅŸilik Yatak',
      description: 'BÃ¼tÃ§e dostu ekonomik odalarÄ±mÄ±z, temel ihtiyaÃ§larÄ±nÄ±zÄ± karÅŸÄ±layacak ÅŸekilde tasarlanmÄ±ÅŸtÄ±r. Tek baÅŸÄ±na seyahat edenler ve bÃ¼tÃ§e odaklÄ± misafirlerimiz iÃ§in ideal bir seÃ§enek.',
      features: [
        { icon: 'ğŸ’°', name: 'Ekonomik', description: 'BÃ¼tÃ§e dostu fiyat' },
        { icon: 'â„ï¸', name: 'Klima', description: 'Merkezi klima sistemi' },
        { icon: 'ğŸ“¶', name: 'Ãœcretsiz WiFi', description: 'YÃ¼ksek hÄ±zlÄ± internet' },
        { icon: 'ğŸ“º', name: 'TV', description: 'Uydu yayÄ±nÄ±' },
        { icon: 'ğŸ›', name: 'Banyo', description: 'Modern donanÄ±mlÄ±' },
        { icon: 'ğŸ§Š', name: 'Mini BuzdolabÄ±', description: 'Ä°htiyaÃ§larÄ±nÄ±z iÃ§in' }
      ],
      amenities: ['Ekonomik', 'Klima', 'WiFi', 'TV', 'Banyo', 'Mini BuzdolabÄ±']
    }
  ];

  call() {
    window.location.href = `tel:${this.phoneNumber}`;
  }

  openWhatsApp() {
    const message = encodeURIComponent('Merhaba, oda rezervasyonu hakkÄ±nda bilgi almak istiyorum.');
    window.open(`https://wa.me/${this.whatsappNumber}?text=${message}`, '_blank');
  }

  handleImageError(event: Event) {
    const img = event.target as HTMLImageElement;
    if (img) {
      img.src = 'assets/images/standart-room.JPG';
    }
  }

  loadGalleryImages(event: Event, room: any) {
    const gallery = (event.target as HTMLElement).closest('.room-gallery');
    if (gallery) {
      const images = gallery.querySelectorAll('img[data-src]');
      images.forEach((element) => {
        const img = element as HTMLImageElement;
        if (img.dataset['src']) {
          img.src = img.dataset['src'];
          img.removeAttribute('data-src');
        }
      });
    }
  }

  trackByRoom(index: number, room: any): number {
    return room.id || index;
  }

  trackByFeature(index: number, feature: any): string {
    return feature.name || index;
  }

  trackByGallery(index: number, img: string): string {
    return img || `img-${index}`;
  }
}
